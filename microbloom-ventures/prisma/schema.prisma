generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["clientExtensions"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  passwordHash String?
  role         UserRole @default(USER)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  orders        Order[]
  subscriptions Subscription[]
  appointments  DietAppointment[]
  applications  Application[]

  // Enrollment relation (opposite side)
  enrollments Enrollment[] @relation("UserEnrollments")
}

enum UserRole {
  ADMIN
  STAFF
  USER
}

model Service {
  id          String   @id @default(cuid())
  slug        String   @unique
  title       String
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Course {
  id          String   @id @default(cuid())
  slug        String   @unique
  title       String
  description String
  curriculum  Json?
  duration    Int?
  fees        Int?
  eligibility String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // enrollments relation (opposite side)
  enrollments Enrollment[] @relation("CourseEnrollments")
}

model Enrollment {
  id String @id @default(cuid())

  // User relation (explicit relation name)
  user   User   @relation("UserEnrollments", fields: [userId], references: [id])
  userId String

  // Course relation (explicit relation name)
  course   Course @relation("CourseEnrollments", fields: [courseId], references: [id])
  courseId String

  status    String   @default("PENDING")
  createdAt DateTime @default(now())
}

model Product {
  id          String      @id @default(cuid())
  sku         String      @unique
  title       String
  description String?
  priceCents  Int
  inventory   Int         @default(0)
  category    String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  orders      OrderItem[]
}

model Order {
  id         String      @id @default(cuid())
  user       User?       @relation(fields: [userId], references: [id])
  userId     String?
  totalCents Int
  status     String      @default("PENDING")
  stripeId   String?
  createdAt  DateTime    @default(now())
  items      OrderItem[]
  shipping   Json?
}

model OrderItem {
  id        String  @id @default(cuid())
  order     Order   @relation(fields: [orderId], references: [id])
  orderId   String
  product   Product @relation(fields: [productId], references: [id])
  productId String
  quantity  Int
  unitCents Int
}

model Subscription {
  id           String    @id @default(cuid())
  user         User      @relation(fields: [userId], references: [id])
  userId       String
  plan         String
  interval     String
  active       Boolean   @default(true)
  nextChargeAt DateTime?
  createdAt    DateTime  @default(now())
}

model BlogPost {
  id          String    @id @default(cuid())
  slug        String    @unique
  title       String
  excerpt     String?
  content     String    @db.Text
  author      String?
  published   Boolean   @default(false)
  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Internship {
  id          String   @id @default(cuid())
  title       String
  description String   @db.Text
  location    String?
  stipend     Int?
  duration    Int?
  createdAt   DateTime @default(now())

  // opposite side of Application relation
  applications Application[]
}

model Application {
  id           String      @id @default(cuid())
  user         User?       @relation(fields: [userId], references: [id])
  userId       String?
  internship   Internship? @relation(fields: [internshipId], references: [id])
  internshipId String?
  resumeUrl    String?
  message      String?
  status       String      @default("RECEIVED")
  createdAt    DateTime    @default(now())
}

model DietAppointment {
  id          String    @id @default(cuid())
  user        User?     @relation(fields: [userId], references: [id])
  userId      String?
  illnessType String?
  reportUrl   String?
  planUrl     String?
  scheduledAt DateTime?
  status      String    @default("REQUESTED")
  createdAt   DateTime  @default(now())
}
